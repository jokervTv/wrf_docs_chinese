---
title: WRFDA 算法的改进
date: 2020-03-24
categories:
 - WRF 技术手册-第四版
tags:
 - translate
 - WRF
description: WRF 技术手册 第 4 版 中英对照文档
autoGroup-11: 数据同化
---

[[toc]]

相对于 MM5 3DVAR 技术说明（Barker 等人，2003）和 ARW 第 3 版技术说明（Skamarock 等人，2008）中所述，WRFDA（V4）的最新版本进行了许多改进，其中包括四维变分（4D-Var）和混合变分/集合（Hybrid-EnVar）数据同化技术，卫星辐射的直接同化，雷达数据同化的改进以及其他新功能中对控制变量的更多选择。
这些将在下面简要概述，更多详细信息可以在引用的参考文献中找到。

## 11.2.1 四维变分和预测对观测的敏感性

4D-Var 的初始功能是在 WRFDA 3.1 中引入的（Huang 等，2009），Zhang 等人对此进行了进一步的改进（2013，2014 年）。
WRFDA 4D-Var 允许使用 LBC 控制变量和 Jc-DFI（以控制重力波）。
4D-Var 模式下的 WRFDA 分析涉及在同化时间范围最小化过程中 ARW 的切线线性模型（TLM）的前向集成和 ARW 伴随模型（ADJ）的向后集成。
在 4.0 版中，WRFPlus 代码（即 WRF 的 TLM/ADJ）已完全集成到 WRF 主代码存储库中，这将简化将来的代码维护和开发。
虽然完整的 ARW 动力学的 TLM/ADJ（位于 WRF 源代码的 `wrftladj` 目录下）在 WRFPlus 代码中可用，但只有少数 WRF 物理方案具有相应的 TLM/ADJ，包括大规模冷凝和改良的 Kessler （温雨（Wang 等人，2013b) 方案，简化的积云参数化方案，垂直扩散和重力波阻力。
WRFPlus V4 尚未实现 ARW V4 的两个新功能（混合垂直坐标和湿势温度）中的 TLM/ADJ，但预计将在将来的版本中提供。
值得注意的是，自 3.4 版本以来，降水数据可以用 4D-Var 进行同化（Ban 等人，2017）。

WRFDA 还引入了计算对观测值的预测敏感性（FSO）的功能（Zhang 等人，2015）。
FSO 允许使用 ARW 和 WRFDA 的伴随计算出不同观测值的预测影响。
请注意，在使用 WRFDA 计算 FSO 时，需要使用 Lanczos 最小化算法而不是共轭梯度法。

## 11.2.2 混合变分/集成技术

WRFDA 的 4D-Var 通过使用线性预测模型提供隐含的流相关的预测误差协方差，以在较短的时间范围内演变出扰动。
但是，这是有代价的。维护线性预测模型及其伴随物既需要计算资源，也需要人力资源。

混合变分/集合数据同化尝试将集合数据同化的优点（流依赖性和灵活性）与变分系统的优点（同时处理观测值，动态/物理约束，复杂的质量控制，通过外循环处理非线性等）结合起来 ）。
WRFDA 混合算法（Wang 等，2008a，b）采用了所谓的 α 控制变量公式，该公式首先在英国气象局实施。
WRFDA hybrid 可在 3D（即 hybrid-3DEnVar）或 4D（即 hybrid-4DEnVar）模式下运行，并允许双分辨率配置（Schwartz 等人，2015），即高分辨率的确定性背景和分析，以及较低分辨率的集合输入。

值得注意的是，Hybrid-EnVar 算法使用由输入集形成的流相关的背景误差协方差来生成单个确定性分析，可以通过不同的方式获得该分析。
最简单的方法是从“第三方集合预测系统（EPS）（例如 NCEP 的全球集合预报系统（GEFS））获得集合输入。
在这种情况下，由于不需要运行自己的集合预测，因此可大大降低计算成本。
可以说，更好的方法是通过选择模型和分辨率来进行自己的集合分析和预测。
WRFDA 软件包包括一个程序，该程序执行集合变换卡尔曼滤波器（ETKF）以产生集合分析，然后可以生成集合预测并将其用作 WRFDA 混合分析的输入。
进行集合分析的另一种可能性是运行 WRFDA 混合 EnVar 集合，并对每个成员分析进行观察。

## 11.2.3 卫星辐射数据同化

WRFDA 3.1 中引入了辐射数据同化功能（Liu 和 Barker，2006 年）。
WRFDA 可以提取 NCEP GFS 模型中可操作的大多数 BUFR 格式辐射数据（HIRS，AMSU-A/B，MHS，AIRS，IASI，ATMS，SSMIS 和 SEVIRI）。
此外，还可以将 HDF 格式的 AMSR2 辐射数据（Yang 等，2016）和 NETCDF 格式的 GOES-Imager 辐射数据（Yang 等，2017）同化。
WRFDA 系统的独特之处在于它与两种最广泛使用的快速辐射转移模型（RTM）交互：TOVS 的辐射转移（RTTOV）和社区辐射转移模型（CRTM），分别由欧洲气象卫星开发组织（EUMETSAT）和美国卫星数据同化联合中心（JCSDA）分别开发和维护。
到 RTTOV 和 CRTM 的灵活接口确保 WRFDA 用户可以从任何一个 RTM 可以模拟的传感器中吸收辐射数据，前提是已实施了相应的数据接口和质量控制。

卫星辐射测量和 RTMs 容易出现系统误差（即偏差），必须先进行校正才能吸收辐射。
偏差通常随平台，仪器，通道，扫描角度和大气条件而变化。
WRFDA 采用所谓的变分偏差校正（VarBC）算法进行自适应和在线辐射偏差校正，该方法将线性回归中的偏差校正系数更新为变分最小化的一部分（Dee，2004; Auligne et al。，2007）。
值得一提的是，WRFDA 中提供了离线 VarBC 功能，以生成偏差校正系数的统计数据，而无需运行实际的 WRFDA 分析，这在进行短期数据同化实验时非常有用（Liu  等人，2012）。

对于晴空条件下的辐射同化，WRFDA 实施了两种先进的高光谱红外传感器云检测方法，如 AIRS 和 IASI（Xu 等人，2013 年，2014 年，2015 年；Auligne，2014a，b），这可以实现同化在云层上方达到峰值的通道。
在 3.9 版中，随着对全天空数据的所谓“对称误差模型”的发展（Geer 和 Bauer，2011），引入了 AMSR2 辐射数据的全天空辐射同化功能（Yang 等，2016）。

11.2.4 雷达数据同化

WRFDA v3 提供了吸收多普勒雷达径向速度和反射率观测值的初始功能（Xiao 等人，2005，2007a，b，2008）。
为了分析由于吸收了雷达径向速度而产生的垂直速度，引入了 Richarson 平衡方程及其线性和伴随代码。
对于反射率吸收，将总含水量用作控制变量。
这要求在最小化过程中在水汽和水凝物增量之间进行分配。
包括一个暖雨参数化以帮助计算水汽现象，包括水汽凝结成云，雨水积聚云，将云自动转换成雨以及将雨水蒸发成水蒸气。
包括多普勒径向速度和反射率的观测算子。

从 3.7 版开始，WRFDA 包括一个附加选项，可以以 3D-Var 或 4D-Var 模式吸收雷达反射率检索到的水汽剖面（Wang 等，2013a，b； Sun 和 Wang，2013）。
还实现了吸收零回波雷达反射率的初步功能。

## 11.2.5 控制变量的选择

WRFDA 使用平方根 $B$ 预处理，使得 $B = UU^T$（更多信息，请参见 11.3）。
背景误差协方差矩阵 $B$ 从未在模型空间 $x'$：$u，v，T，q，p_s$ 中明确计算。
在控制变量空间 $\mathbf{v}$ 中，WRFDA 的成本函数被迭代最小化，该变量通过控制变量转换 $U$ 与模型空间相关，即

$$
x' = U\mathbf{v} = U_p U_v U_h \mathbf{v} \tag{11.2}
$$

展开 $U=U_p U_v U_h$ 表示协方差建模的各个阶段：通过递归滤波器的水平相关 $U_h$，通过 EOF 分解的垂直协方差 $U_v$，以及通过统计回归的多元协方差 $U_p$。

选择 $\mathbf{v}$ 的分量，以使它们的误差互相关可忽略不计，从而使矩阵 $B$ 可以进行块对角线化。
通过名称列表参数 “`cv_options`”，WRFDA 中可以选择三种控制变量：

- `cv_options`=5：流函数 $\psi'$，不平衡速度势 $\chi'_u$，不平衡温度 $T'_u$，假相对湿度 $rh'$，不平衡表面压力 $ps'_u$。此选项允许在质量场和风场之间进行统计互相关，并进行单变量 $rh$ 分析（即 $rh$ 与其他变量之间没有互相关）。
- `cv_options`=6：（Chen et al。，2013）：流函数 $\psi'$，不均衡的潜在潜力 $\chi'_u$，不均衡的温度 $T'_u$，不均衡的假相对湿度 $rh'$，不均衡的表面压力 $ps'_u$。除了质量场和风场平衡之外，此选项还允许水分和其他变量之间相互关联，这在热带地区可能更为重要。
- `cv_options`=7：（Sun 等，2015）：纬向风 $u'$，经向风 $v'$，温度 $T'$，假相对湿度 $rh'$，表面压力 $ps'$。这些变量之间没有互相关（因此是完全单变量分析）。

附加的 `cv_options`=3 与 `cv_options`=5 相似，不同之处在于它使用递归过滤器而不是 EOF 分解进行垂直协方差，并且相应的背景误差协方差统计信息（由 WRFDA 发布）并非基于 ARW 预测。
在调试代码以进行新开发时（例如，添加新的观察类型），此选项很有用，但不建议用于需要分析和预测性能的操作环境。
为了获得最佳性能，建议遵循第（11.3）节中描述的过程，为选定的 `cv_options`= 5、6 或 7 使用适当的 ARW 模型设置来获得背景误差协方差统计信息。

除了五个设置由 **`cv_options`** 控制的控制变量外，WRFDA 还可以分析与水凝物（*qcloud*，*qrain*，*qice*，*qsnow* 和 *qgraupel*）和垂直速度 $w$ 有关的变量。
需要这些控制变量来吸收受云/降水影响的观测值（例如，雷达反射率，全天辐射）和雷达径向速度数据。
分别由 namelist 参数 `cloud_cv_options`（= 0、1、2 或 3）和 `use_cv_w`（=  true 或 false）控制对水汽变量和垂直速度的分析。

## 11.2.6 其他改进

下面简要介绍了其他几个改进。

- a）在版本 3.8 中引入的“弱罚约束”（WPEC）选项（Li 等，2015）旨在在分析中强制实现准梯度平衡。它的设计旨在改善热带气旋内雷达数据的同化性，但可能对类似规模的其他天气现象很有用。它可以与 3D-Var 或 Hybrid-3DEnVar 一起使用（4D-Var 与该功能不兼容）。
- b）在版本 4.0 中，添加了散度约束（DIVC）项以对 $u$ 和 $v$ 之间的相关性进行建模。DIVC 是通过在成本函数中添加一个约束水平散度的项来实现的（Tong 等人，2016）。
- c）在 4.0 版本中引入的大尺度分析约束（LSAC）选项（Vendrasco 等人，2016）确保对流规模分析不会扭曲大尺度平衡，并消除了可能的大尺度偏差在 ARW 背景场中。全局分析或预测（例如来自 GFS 或 FNL 的分析或预测）被视为虚假观察，并通过 WRFDA 进行了吸收。使用 WPS/REAL 准备 LSAC 的输入数据，与准备 ARW 输入数据相同。
- d）在 4.0 版中增加了使用 GPS 多余相位（GPSEPH）非局地算子来同化 GPS 无线电掩星（GPSRO）折射率数据的新选项（Chen 等，2009），并采用了（Zhang 等，2014b）中描述的并行化策略。
- e）从 3.5 版开始，除了最初吸收 u 和 v 分量外，WRFDA 还可以根据风速和风向吸收风的观测值（Huang 等，2013； Gao 等，2015）。
